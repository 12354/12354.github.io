<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Propagation Paths in the Rooms and Portals Signal Model</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="akdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Wwise SDK 2023.1.0 - Windows
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Propagation Paths in the Rooms and Portals Signal Model </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The following sections explain how Spatial Audio affects signal flow in the voice and bus graph, and how it does so in relation to the sound propagation model.</p>
<p>It helps to understand how Spatial Audio controls the voice and bus graph, and how it does so in relation to the sound propagation model. This sections explains the signal flow in the light of the sound propagation model.</p>
<h1><a class="anchor" id="spatial_audio_roomsportals_paths_connections"></a>
Paths and Connections</h1>
<p>At runtime, voices and busses are connected to other busses, as can be seen in the Voice Graph or the Voice Inspector views of the Wwise Profiler. The "wires" between these Wwise Objects are referred to as Connections. An emitter-listener pair is created whenever a voice or bus associated to a game object (an emitter or a room) is connected to a different game object (another room, or the top-level listener). Emitter-listener pairs, which we will refer to as paths for the rest of this discussion, are used to compute attenuation curves, amongst other things. There can be zero, one, or many paths within one connection. For example, when the game sets multiple positions to a game object using <a class="el" href="namespace_a_k_1_1_sound_engine_a79fc25a0656b560e0e601a558be26e31.html#a79fc25a0656b560e0e601a558be26e31">AK::SoundEngine::SetMultiplePositions</a>, multiple paths are created. Spatial Audio uses paths extensively. In the following discussion, we will examine the paths within each connection in the simple scenario where an emitter is located in a room, adjacent to that of the listener, as illustrated by the signal graph below.</p>
<div class="image">
<img src="voicegraph.png" alt=""/>
</div>
<h1><a class="anchor" id="spatial_audio_roomsportals_paths_direct"></a>
Emitter-Listener (Direct) Connection</h1>
<p>The connection between the Emitter and Listener carries the dry (unreverberated) signal between the emitter and the listener. Spatial Audio creates a first path between the position of the emitter and the position of the listener to represent the sound wave that travels directly from the emitter to the listener. Its length is thus the distance between the two, and the emitter's attenuation curves are evaluated based on that distance. Also, when the emitter and listener are in different rooms, unless a portal gives them direct line of sight, an additional occlusion factor is added to this path: it is the maximum of both rooms' transmission loss. We call this path the direct path, or the transmission path, depending on whether it has a zero or non-zero transmission loss.</p>
<p>When a portal is open between both rooms, another sound wave can reach the listener by means of diffraction. This is the diffraction path. It bends around the edge of the portal, and its total length is thus longer than that of the transmission path. It does not have transmission loss, but instead it has diffraction, proportional to the angle by which it bends. There are as many diffraction paths as there are open portals between two rooms.</p>
<p>The following image of the Voice Inspector shows two paths on the Direct Connection: one for transmission and one for diffraction through a portal.</p>
<div class="image">
<img src="rays_direct.png" alt=""/>
</div>
<p>The following table describes the paths of the Direct Connection.</p>
<table border="1" cellspacing="0" cellpadding="1" width="800px">
<tr>
<th>Path Type (Number)</th><th>Characteristics </th></tr>
<tr>
<td>Transmission/Line-of-sight (1) </td><td><ul>
<li>
<b>Distance</b>: Straight line from emitter to listener </li>
<li>
<b>Transmission Loss</b>: Maximum of Room's Transmission Loss and transmission loss of occluding geometry </li>
<li>
<b>Spread</b>: Emitter's (from the sound's Attenuation, or from the game object radius - see <a class="el" href="spatial_audio_roomsportals_apioverview.html#spatial_audio_roomsportals_spreadgameobjectspread">Game Object Spread</a>) </li>
</ul>
</td></tr>
<tr>
<td>Diffraction (N) </td><td><ul>
<li>
<b>Distance</b>: Diffraction path's length </li>
<li>
<b>Diffraction</b>: Sum of Portal Diffraction and diffraction on geometry edges  </li>
<li>
<b>Spread</b>: Emitter's (from the sound's Attenuation, or from the game object radius - see <a class="el" href="spatial_audio_roomsportals_apioverview.html#spatial_audio_roomsportals_spreadgameobjectspread">Game Object Spread</a>), further clamped by the portal's aperture </li>
</ul>
</td></tr>
</table>
<table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> No delay is applied to the diffraction paths, even though the wavefronts taking those paths travel a longer distance and should thus arrive at the listener later than those taking the transmission path. </td></tr>
</table>
<p>All paths are contained within the same connection. They can be viewed as parallel sound propagation paths. Indeed, the signal of Markers_Test that is mixed into Master Audio Bus is panned and attenuated independently for each path. However, it is filtered by a single filter unit, whose cut-off frequency is based on the transmission-driven and diffraction-driven filter values of the various paths, and their respective prominence.</p>
<table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> Technically, the existence of multiple paths in parallel should not violate the principle of energy conservation. Spatial Audio does not attempt to normalize the paths' volume in order to respect this principle. However, it utilizes the Multi-Direction panning method of the sound engine, which achieves a similar result in terms of volume normalization. </td></tr>
</table>
<h1><a class="anchor" id="spatial_audio_roomsportals_paths_ercoupling"></a>
Emitter-Room Connection</h1>
<div class="image">
<img src="rays_er_rl_annotated.png" alt=""/>
</div>
<table border="1" cellspacing="0" cellpadding="1">
<tr>
<td><div class="image">
<img src="Callout1.png" alt=""/>
</div>
 </td><td>Emitter-Room connection  </td></tr>
<tr>
<td><div class="image">
<img src="Callout2.png" alt=""/>
</div>
 </td><td>Room-Listener connection  </td></tr>
</table>
<p>The auxiliary connection of the emitter towards the Room bus represents the energy injected by the source that reverberates inside the room and produces a diffuse field. There is a connection to the room that the emitter occupies, and additional connections to rooms adjacent to the emitter. If an emitter occupies the same room as the listener, there will be connections for every adjacent room, otherwise there will only be connections for rooms along active paths between the emitter and listener. The adjacent room connections, and their send levels, represent the proportion of acoustic energy that is lost through portals. The remaining proportion is sent to the emitter's room.</p>
<p>The path associated with this connection has zero distance, and no transmission loss or diffraction. This means that the model assumes that the distance attenuation due to the average distance traveled from sources within that room to its walls, and then all the further distances traveled from wall to wall, are entirely conveyed by the impulse response of the reverb Effect on the room's bus. It also assumes that the geometry inside the room does not significantly obstruct the sound from the walls.</p>
<h1><a class="anchor" id="spatial_audio_roomsportals_paths_rl"></a>
Room-Listener Connection</h1>
<p>The connection between the room's bus and the listener represents the room's diffuse energy, simulated by the reverb Effect, propagating to the listener. It reaches the listener through the room's walls, and via its portals. Similar to the Direct Connection, this connection embeds a single transmission path and one diffraction path per portal that is visible to the listener. The transmission path is attenuated by the room's transmission loss, and its Spread is computed from the room's estimated extent (see <a class="el" href="spatial_audio_roomsportals_apiconfig.html#spatial_audio_roomsportals_apiconfigroomgeometry">Setting up Room Geometry</a>). Diffraction paths assume that the diffuse energy exits the room on trajectories perpendicular to the portals' opening, so diffraction angles are computed from portals' normal vectors. Diffraction paths' Spread is computed based on the listener's position and angle relative to the portals' extents.</p>
<table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> The model does not take into account further obstruction due to geometry outside the room. The effect of this geometry is assumed to be negligible. </td></tr>
</table>
<p>The length of these paths, which determines their distance attenuation, is discussed in the next section.</p>
<h1><a class="anchor" id="spatial_audio_roomsportals_paths_wetdistance"></a>
Distance-Based Attenuation of the Wet Signal</h1>
<p>The length of the paths introduced in the previous section, which represent the propagation of a room's diffuse energy to the listener, cannot be defined exactly. The model assumes that the attenuation of sound due to the distance traveled towards the walls and then from wall to wall is completely deferred to the reverb Effect itself. Thus, a reasonable approximation of a path's origin would be the middle of the room. However, a more satisfying result is obtained if the distance attenuation of the room's diffuse energy depends on whether the source that excited it is located closer or farther from the listener, especially if the room is large.</p>
<p>Furthermore, contrary to real-life physics, sounds in Wwise attenuate over distance using custom curves. In order to accurately compute the distance attenuation of the room to the listener, the room should use the sound emitter's attenuation curves. This poses a problem, because there can be multiple emitters in a room, each with its own position, and each with its own attenuation curve. Once all sounds within a room have been downmixed and passed through a reverb Effect, it is impossible to selectively scale their volume based on their respective distance attenuation.</p>
<p>A brute-force solution to this problem would be to have a distinct bus and reverb effect for each sound within this room. Since this would be prohibitively costly, Spatial Audio implements the following instead: The distance evaluation and attenuation, for the entirety of the distance between the emitter and listener, is applied on the connection between the emitter and its immediate room bus. That is, prior to the downmix and reverberation. This is mathematically equivalent to having one bus and reverb per source, as long as the Effects on the bus are linear. This is generally true with reverb Effects.</p>
<h1><a class="anchor" id="spatial_audio_roomsportals_paths_erlrrevisited"></a>
Emitter-Room and Room-Listener Connections, Revisited</h1>
<p>Attenuation, as well as Occlusion, Obstruction, Transmission Loss and Diffraction of the wet path is applied on the Emitter-Room connection, using the attenuation specified on the emitter. Setting an attenuation on a room bus will have no effect.</p>
<p>The following table describes the paths of the Emitter-Room Connection.</p>
<table border="1" cellspacing="0" cellpadding="1" width="800px">
<tr>
<th>Path Type (Number)</th><th>Characteristics </th></tr>
<tr>
<td>Transmission/Line-of-sight (1) </td><td><ul>
<li>
<b>Distance</b>: Straight line from emitter to listener </li>
<li>
<b>Transmission Loss</b>: 0 </li>
<li>
<b>Spread</b>: 0 (irrelevant) </li>
</ul>
</td></tr>
<tr>
<td>Diffraction (N) </td><td><ul>
<li>
<b>Distance</b>: Diffraction path's length </li>
<li>
<b>Diffraction</b>: 0 </li>
<li>
<b>Spread</b>: 0 (irrelevant) </li>
</ul>
</td></tr>
</table>
<p>The following table describes the paths of the Room-Listener Connection.</p>
<table border="1" cellspacing="0" cellpadding="1" width="800px">
<tr>
<th>Path Type (Number)</th><th>Characteristics </th></tr>
<tr>
<td>Transmission/Line-of-sight (1) </td><td><ul>
<li>
<b>Distance</b>: 0 (moved to the Emitter-Room connection) </li>
<li>
<b>Transmission Loss</b>: Maximum of Room's Transmission Loss and transmission loss of occluding geometry </li>
<li>
<b>Spread</b>: Based on the room's extent (see <a class="el" href="spatial_audio_roomsportals_apiconfig.html#spatial_audio_roomsportals_apiconfigroomgeometry">Setting up Room Geometry</a>) </li>
</ul>
</td></tr>
<tr>
<td>Diffraction (N) </td><td><ul>
<li>
<b>Distance</b>: 0 (moved to the Emitter-Room connection) </li>
<li>
<b>Diffraction</b>: Sum of Portal Diffraction and diffraction on geometry edges  </li>
<li>
<b>Spread</b>: Emitter's (from the sound's Attenuation, or from the game object radius (see <a class="el" href="spatial_audio_roomsportals_apioverview.html#spatial_audio_roomsportals_spreadgameobjectspread">Game Object Spread</a>), further clamped by the portal's aperture </li>
</ul>
</td></tr>
</table>
<p>The following image shows the paths of both connections in the Voice Inspector. The bottom half shows the paths in the Emitter-Room connection, where distance attenuation, transmission loss, and diffraction are applied. The top half shows the paths in the Room-Listener connection (under "None" because the room's bus has no Attenuation ShareSet).</p>
<div class="image">
<img src="rays_er_rl__details_annotated.png" alt=""/>
</div>
<table border="1" cellspacing="0" cellpadding="1">
<tr>
<td><div class="image">
<img src="Callout1.png" alt=""/>
</div>
 </td><td>Room-Listener connection  </td></tr>
<tr>
<td><div class="image">
<img src="Callout2.png" alt=""/>
</div>
 </td><td>Emitter-Room connection  </td></tr>
</table>
<h1><a class="anchor" id="spatial_audio_roomsportals_paths_coupling"></a>
Coupling Between Rooms</h1>
<p>The connection between the Emitter's room and the Listener's room represents the diffuse energy of the emitter's room transferred into the listener's room and contributing to the latter's diffuse energy. This transfer occurs through walls and open portals.</p>
<p>Paths are created for transmission through walls and diffraction through portals. The transmission path has a transmission loss equal to the maximum of both rooms' transmission loss. Diffraction paths have 0% diffraction, because sound waves exiting from portals don't need to bend around an edge to excite the receiving room.</p>
<table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> If an open portal exists, its propagation path will likely dominate the transmission path and enable coupling of both rooms at full volume. The model does not try to modulate the transfer of energy based on the surface ratio of open portals versus walls. This should be improved in a future release. </td></tr>
</table>
<table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> The model assumes that geometry in the receiving room does not interfere with the transfer of energy from the emitting room. </td></tr>
</table>
<p>These propagation paths should also be subject to distance attenuation, but this attenuation has already been accounted for since it has been distributed to the Emitter-Room connection (see the discussion in <a class="el" href="spatial_audio_roomsportals_paths.html#spatial_audio_roomsportals_paths_wetdistance">Distance-Based Attenuation of the Wet Signal</a>).</p>
<p>The following table describes the paths of the Emitter's Room to Listener's Room connection.</p>
<table border="1" cellspacing="0" cellpadding="1" width="800px">
<tr>
<th>Path Type (Number)</th><th>Characteristics </th></tr>
<tr>
<td>Transmission/Line-of-sight (1) </td><td><ul>
<li>
<b>Distance</b>: 0 (moved to the Emitter-Room connection) </li>
<li>
<b>Transmission Loss</b>: Maximum of both Rooms' Transmission Loss </li>
<li>
<b>Spread</b>: 0 (irrelevant) </li>
</ul>
</td></tr>
<tr>
<td>Diffraction (N) </td><td><ul>
<li>
<b>Distance</b>: 0 (moved to the Emitter-Room connection) </li>
<li>
<b>Diffraction</b>: 0 </li>
<li>
<b>Spread</b>: 0 (irrelevant) </li>
</ul>
</td></tr>
</table>
<table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Tip.gif" alt="" class="inline"/></td><td><b>Tip:</b> You can offset the volume of coupling connections by using the Game-defined aux send's Volume in the authoring tool. This volume applies to a given room bus towards all connected rooms. </td></tr>
</table>
<h1><a class="anchor" id="spatial_audio_roomsportals_paths_lrl"></a>
Connection Between Listener's Room and the Listener</h1>
<p>This connection represents the diffuse energy of the listener's room that envelops the listener. The distance attenuation has already been accounted for at the input of the connection, and therefore applies no additional attenuation. It is also assumed to be unobstructed, and its Spread is close to 100%. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</body>
</html>
