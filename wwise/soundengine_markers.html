<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Integrating Markers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="akdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Wwise SDK 2023.1.0 - Windows
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Integrating Markers </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="soundengine_markers_intro"></a>
Introduction</h1>
<p>Markers are identifiers that are inserted in a WAV file and used to tag a position in the waveform. These markers are usually created in a WAV editor application, such as SoundForgeÂ®, AdobeÂ® AuditionÂ®, or CueTool.</p>
<p>An application can use these markers to be notified when a certain position is reached during playback. For example, you could use this information to synchronize content drawing with the audio being played, or to know which file is being played by a random container so that the correct subtitles can be displayed in your game.</p>
<table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> Using Wwise marker notifications is usually the most efficient way to integrate a lip-sync or subtitle solution. </td></tr>
</table>
<h1><a class="anchor" id="soundengine_markers_fileformat"></a>
Working with the.wav File Format</h1>
<p>Chunks are data storage units used to store cue points, or data about cue points. Cue points are points of interest flagged in .wav format files.</p>
<h2><a class="anchor" id="soundengine_markers_fileformat_cueChunk"></a>
Cue Chunks</h2>
<p>The cue chunk format is used to store marker positions that indicate points of interest in a .wav file.</p>
<div class="fragment"><div class="line">Offset  Bytes   Description         Value</div>
<div class="line">0x00    4       Chunk ID            <span class="stringliteral">&quot;cue &quot;</span> (0x63756520)</div>
<div class="line">0x04    4       Chunk Data Size     Depends on the number of cue points</div>
<div class="line">0x08    4       Num Cue Points      Number of cue points in list</div>
<div class="line">0x0c    Cue Points</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="preprocessor">#define CueID &#39;cue &#39;  </span><span class="comment">/* chunk ID for cue chunk */</span><span class="preprocessor"></span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">  ID        chunkID;</div>
<div class="line">  <span class="keywordtype">long</span>      chunkSize;</div>
<div class="line">  <span class="keywordtype">long</span>      dwCuePoints;</div>
<div class="line">  CuePoint  points[];</div>
<div class="line">} CueChunk;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">  <span class="keywordtype">long</span>    dwIdentifier;</div>
<div class="line">  <span class="keywordtype">long</span>    dwPosition;</div>
<div class="line">  ID      fccChunk;</div>
<div class="line">  <span class="keywordtype">long</span>    dwChunkStart;</div>
<div class="line">  <span class="keywordtype">long</span>    dwBlockStart;</div>
<div class="line">  <span class="keywordtype">long</span>    dwSampleOffset;</div>
<div class="line">} CuePoint;</div>
</div><!-- fragment --><h2><a class="anchor" id="soundengine_markers_fileformat_list"></a>
List Chunks</h2>
<p>A list chunk is a container inside the .wav file which contains subchunks. The associated data list chunk (adtl) format is used to store labels, notes, and text associated to a cue point.</p>
<div class="fragment"><div class="line">Offset  Bytes   Description         Value</div>
<div class="line">0x00    4       Chunk ID            <span class="stringliteral">&quot;list&quot;</span> (0x6C696E74)</div>
<div class="line">0x04    4       Chunk Data Size     Depends on contained sub-chunks</div>
<div class="line">0x08    4       Type ID             <span class="stringliteral">&quot;adtl&quot;</span> (0x6164746C)</div>
<div class="line">0x0c    SubChunks start here</div>
</div><!-- fragment --><h2><a class="anchor" id="soundengine_markers_fileformat_labl"></a>
Label Sub-Chunks</h2>
<p>The label sub-chunk format is used to store a string associated with a cue point. It should be inside the associated data list chunk.</p>
<div class="fragment"><div class="line">Offset  Bytes   Description         Value</div>
<div class="line">0x00    4       Chunk ID            <span class="stringliteral">&quot;labl&quot;</span> (0x6C61626C)</div>
<div class="line">0x04    4       Chunk Data Size     Depends on size of text</div>
<div class="line">0x08    4       Cue Point ID        Refers to cue chunk dwIdentifier</div>
<div class="line">0x0c    Label (variable-size text)</div>
</div><!-- fragment --><h1><a class="anchor" id="soundengine_markers_howto"></a>
How to Use Marker Notifications</h1>
<p>Here are instructions on how to design your application so that it receives the marker notifications:</p>
<ul>
<li>When posting a play event, you should add the <code>AK_Marker</code> flag to <code>in_uiFlags</code>. If you also want to have the end of event notification, you should use <code>AK_EndOfEvent</code> | <code>AK_Marker</code> since the flags are bitwise exclusive.</li>
</ul>
<div class="fragment"><div class="line">AkPlayingID AK::SoundEngine::PostEvent(</div>
<div class="line">    AkUniqueID in_eventID,                  <span class="comment">// Unique ID of the event</span></div>
<div class="line">    AkGameObjectID in_gameObjectID,         <span class="comment">// Associated game object ID</span></div>
<div class="line">    AkUInt32 in_uFlags = 0,                 <span class="comment">// Bitmask: see AkCallbackType</span></div>
<div class="line">    AkCallbackFunc in_pfnCallback = NULL,   <span class="comment">// Callback function</span></div>
<div class="line">    <span class="keywordtype">void</span> * in_pCookie = NULL                <span class="comment">// Callback cookie that will be sent to the callback function </span></div>
<div class="line">                                            <span class="comment">// along with additional information</span></div>
<div class="line">);</div>
</div><!-- fragment --><ul>
<li>Your callback function must have the following form:</li>
</ul>
<div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> MarkersCallback(</div>
<div class="line">    AkCallbackType in_eType,            <span class="comment">// Type of callback reason, in this case AK_Marker on </span></div>
<div class="line">                                        <span class="comment">// reception of a marker event.</span></div>
<div class="line">    <a class="code" href="struct_ak_callback_info.html">AkCallbackInfo</a>* in_pCallbackInfo    <span class="comment">// Pointer to callback information structure, in this case</span></div>
<div class="line">                                        <span class="comment">// AkMarkerCallbackInfo*.</span></div>
<div class="line">    )</div>
</div><!-- fragment --><ul>
<li>When your callback function is called, you first need to check what type of notification is passed. For example, if you only want to process <code>AK_Marker</code> notifications, you should return when any other event type is received.</li>
<li>Based on the type of notification, you can typecast <code>in_pCallbackInfo</code> into the appropriate information structure type. For AK_Marker notification, it is <a class="el" href="struct_ak_marker_callback_info.html">AkMarkerCallbackInfo</a>.</li>
</ul>
<div class="fragment"><div class="line"><span class="comment">// Callback information structure corresponding to AK_Marker.</span></div>
<div class="line"><span class="keyword">struct </span><a class="code" href="struct_ak_marker_callback_info.html">AkMarkerCallbackInfo</a> : <span class="keyword">public</span> <a class="code" href="struct_ak_event_callback_info.html">AkEventCallbackInfo</a></div>
<div class="line">{</div>
<div class="line">    AkUInt32    uIdentifier;        <span class="comment">// Cue point identifier</span></div>
<div class="line">    AkUInt32    uPosition;          <span class="comment">// Position in the cue point (unit: sample frames)</span></div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> * strLabel;          <span class="comment">// Label of the marker, read from the file</span></div>
<div class="line">};</div>
</div><!-- fragment --><ul>
<li>Make sure you copy the contents of the <code>strLabel</code> string member if you plan to reference it later, as the pointer can be invalidated after the callback returns.</li>
</ul>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="quickstart_sample_integration_events.html">Quick Start Sample Integration - Events</a></dd></dl>
<h1><a class="anchor" id="soundengine_markers_latency"></a>
Notification Latency</h1>
<p>Currently, notification is sent when the buffer is passed down to the hardware. This means that there is a certain constant delay between when the notification is sent and the marker is encountered. This gives your application enough time to gather the information on the marker and process it before the sound associated with that marker is really played.</p>
<p>Note that this delay is platform-dependent.</p>
<h1><a class="anchor" id="soundengine_markers_callback"></a>
Callback Thread</h1>
<p>The callbacks for markers, as well as for the end of event notification, are done from the sound engine's main thread. This means that your application should gather all the information it needs from the notification and return immediately. If any processing needs to be done, it should be performed in a separate thread once the relevant information has been copied from the notification.</p>
<p>If the application holds the thread for too long, the sound engine might fall into an underrun state and the output might stop playing.</p>
<dl class="section note"><dt>Note</dt><dd>The label string from the callback function should be copied because the referenced data will be released by the sound engine after the callback function returns.</dd></dl>
<h1><a class="anchor" id="soundengine_markers_profiler"></a>
Wwise Capture Log and Markers</h1>
<p>The Wwise Profiler can display marker notifications from the sound engine. In order to do so, you must ensure that the Markers Notification Data option in the Profiler Settings dialog is enabled. When a marker is reached and a notification has been requested, a new line will appear in the Capture Log. Note that these notifications can be filtered out if needed by clearing the Markers Notification Data check box in the Capture Log Filter dialog.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="soundengine_events.html">Integration Details - Events</a> </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="astruct_ak_marker_callback_info_a170f3dc5b73d97dcedfc3f94d258ace2_html_a170f3dc5b73d97dcedfc3f94d258ace2"><div class="ttname">AkMarkerCallbackInfo::strLabel</div><div class="ttdeci">const char * strLabel</div><div class="ttdoc">Label of the marker (null-terminated)</div><div class="ttdef"><b>Definition:</b> AkCallback.h:119</div></div>
<div class="ttc" id="astruct_ak_event_callback_info_html"><div class="ttname"><a href="struct_ak_event_callback_info.html">AkEventCallbackInfo</a></div><div class="ttdef"><b>Definition:</b> AkCallback.h:95</div></div>
<div class="ttc" id="astruct_ak_marker_callback_info_html"><div class="ttname"><a href="struct_ak_marker_callback_info.html">AkMarkerCallbackInfo</a></div><div class="ttdef"><b>Definition:</b> AkCallback.h:116</div></div>
<div class="ttc" id="astruct_ak_callback_info_html"><div class="ttname"><a href="struct_ak_callback_info.html">AkCallbackInfo</a></div><div class="ttdef"><b>Definition:</b> AkCallback.h:85</div></div>
<div class="ttc" id="a_common_2_ak_types_8h_a352a1eb6955fa208062e40a9ccdd2560_html_a352a1eb6955fa208062e40a9ccdd2560"><div class="ttname">AkGameObjectID</div><div class="ttdeci">AkUInt64 AkGameObjectID</div><div class="ttdoc">Game object ID.</div><div class="ttdef"><b>Definition:</b> AkTypes.h:142</div></div>
<div class="ttc" id="a_ak_callback_8h_a948c083ff18dc4c8dfe1d32cb0eb6732_html_a948c083ff18dc4c8dfe1d32cb0eb6732"><div class="ttname">AkCallbackType</div><div class="ttdeci">AkCallbackType</div><div class="ttdoc">Type of callback. Used as a bitfield in methods AK::SoundEngine::PostEvent() and AK::SoundEngine::Dyn...</div><div class="ttdef"><b>Definition:</b> AkCallback.h:48</div></div>
<div class="ttc" id="a_common_2_ak_types_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname">NULL</div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> AkTypes.h:46</div></div>
<div class="ttc" id="astruct_ak_marker_callback_info_aa7748e167a3ef098db4d9bb88be3489c_html_aa7748e167a3ef098db4d9bb88be3489c"><div class="ttname">AkMarkerCallbackInfo::uIdentifier</div><div class="ttdeci">AkUInt32 uIdentifier</div><div class="ttdoc">Cue point identifier.</div><div class="ttdef"><b>Definition:</b> AkCallback.h:117</div></div>
<div class="ttc" id="a_common_2_ak_types_8h_a8341fa4d01d2fa852c3cc410401b04dc_html_a8341fa4d01d2fa852c3cc410401b04dc"><div class="ttname">AkUniqueID</div><div class="ttdeci">AkUInt32 AkUniqueID</div><div class="ttdoc">Unique 32-bit ID.</div><div class="ttdef"><b>Definition:</b> AkTypes.h:134</div></div>
<div class="ttc" id="astruct_ak_marker_callback_info_a3cee8ac29ebb9b0bb14d27317da99535_html_a3cee8ac29ebb9b0bb14d27317da99535"><div class="ttname">AkMarkerCallbackInfo::uPosition</div><div class="ttdeci">AkUInt32 uPosition</div><div class="ttdoc">Position in the cue point (unit: sample frames)</div><div class="ttdef"><b>Definition:</b> AkCallback.h:118</div></div>
<div class="ttc" id="anamespace_a_k_1_1_temp_alloc_a94c6067317869a80ec86af6994a0ebd9_html_a94c6067317869a80ec86af6994a0ebd9"><div class="ttname">AK::TempAlloc::Type</div><div class="ttdeci">Type</div><div class="ttdoc">IDs of temporary memory pools used by the sound engine.</div><div class="ttdef"><b>Definition:</b> AkMemoryMgr.h:336</div></div>
<div class="ttc" id="anamespace_a_k_1_1_profiling_i_d_ad10a3840e843bd5b5b72163cdea07fa9_html_ad10a3840e843bd5b5b72163cdea07fa9aba0440f1c7a314dd1c9839e33e5906c8"><div class="ttname">AK::ProfilingID::Num</div><div class="ttdeci">@ Num</div><div class="ttdef"><b>Definition:</b> AkProfilingID.h:75</div></div>
<div class="ttc" id="a_ak_callback_8h_ae97d13f751da3ecb4e684ef01051f99a_html_ae97d13f751da3ecb4e684ef01051f99a"><div class="ttname">AkCallbackFunc</div><div class="ttdeci">void(* AkCallbackFunc)(AkCallbackType in_eType, AkCallbackInfo *in_pCallbackInfo)</div><div class="ttdef"><b>Definition:</b> AkCallback.h:266</div></div>
<div class="ttc" id="a_ak_numeral_types_8h_a39c6c5d577901802ca77775760b704ce_html_a39c6c5d577901802ca77775760b704ce"><div class="ttname">AkUInt32</div><div class="ttdeci">uint32_t AkUInt32</div><div class="ttdoc">Unsigned 32-bit integer.</div><div class="ttdef"><b>Definition:</b> AkNumeralTypes.h:38</div></div>
<div class="ttc" id="anamespace_a_k_1_1_sound_engine_a41e9ef8d42951871fe4a8ae58a29a68e_html_a41e9ef8d42951871fe4a8ae58a29a68e"><div class="ttname">AK::SoundEngine::PostEvent</div><div class="ttdeci">AKSOUNDENGINE_API AkPlayingID PostEvent(AkUniqueID in_eventID, AkGameObjectID in_gameObjectID, AkUInt32 in_uFlags=0, AkCallbackFunc in_pfnCallback=NULL, void *in_pCookie=NULL, AkUInt32 in_cExternals=0, AkExternalSourceInfo *in_pExternalSources=NULL, AkPlayingID in_PlayingID=AK_INVALID_PLAYING_ID)</div></div>
<div class="ttc" id="a_common_2_ak_types_8h_a9270609771369ea575443fe080bbe9c3_html_a9270609771369ea575443fe080bbe9c3"><div class="ttname">AkPlayingID</div><div class="ttdeci">AkUInt32 AkPlayingID</div><div class="ttdoc">Playing ID.</div><div class="ttdef"><b>Definition:</b> AkTypes.h:137</div></div>
</body>
</html>

