<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Memory Manager</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="akdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Wwise SDK 2023.1.0 - Windows
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Memory Manager </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>All modules of the Wwise sound engine access memory through the <a class="el" href="namespace_a_k_1_1_memory_mgr.html">AK::MemoryMgr</a> interface. The client of the sound engine is responsible for initializing and terminating this interface.</p>
<p>A default implementation is provided with the SDK as a static library (AkMemoryMgr.lib). To use this library, the client needs to include the <a class="el" href="_ak_module_8h.html">AkModule.h</a> header, and call the <a class="el" href="namespace_a_k_1_1_memory_mgr_a570a4ed4f667c187d21a821d846f4567.html#a570a4ed4f667c187d21a821d846f4567">AK::MemoryMgr::Init</a> initialization function.</p>
<p>Refer to <a class="el" href="goingfurther_builds.html">Build Configuration</a> for more information regarding the usage of AkMemoryMgr.lib and other libraries.</p>
<h1><a class="anchor" id="memorymanager_init"></a>
Initialization</h1>
<p>In the default implementation, default initialization settings can be obtained using <a class="el" href="namespace_a_k_1_1_memory_mgr_ada3c244e4c16e6863cec97eef039319b.html#ada3c244e4c16e6863cec97eef039319b" title="Obtain the default initialization settings for the default implementation of the Memory Manager.">AK::MemoryMgr::GetDefaultSettings</a>.</p>
<p>Use the following setting to limit the total amount of virtual and device memory allocated by the Memory Manager:</p>
<ul>
<li><a class="el" href="struct_ak_mem_settings_ab95afe86b5ae21cf432d6ca030703055.html#ab95afe86b5ae21cf432d6ca030703055" title="When non-zero, limits the total amount of virtual and device memory allocated by AK::MemoryMgr.">AkMemSettings::uMemAllocationSizeLimit</a></li>
</ul>
<p>Use the following setting to enable additional runtime debugging functionality:</p>
<ul>
<li><a class="el" href="struct_ak_mem_settings_ae97967db68ec10e8410af9f776f89e0d.html#ae97967db68ec10e8410af9f776f89e0d" title="Default 0 disabled. 1 debug enabled. 2 stomp allocator enabled. 3 stomp allocator and debug enabled....">AkMemSettings::uMemoryDebugLevel</a></li>
</ul>
<p>This is an opaque value to allow custom implementations to define as many memory debugging features as they like. The default implementation provides two levels.</p>
<ul>
<li>Level 1 enables basic runtime memory debugging including; capturing <b>FILE</b> and <b>LINE</b> for each allocation, tracking callstacks ( where possible ) for each allocation, reporting leaks in a detailed manner upon shutdown and some very light integrity checks. This is light enough that you may run this during development by default.</li>
<li>Level 2 enables the use of a stomp allocator which uses discrete pages of virtual memory for every allocation and seeks to trap any writes that occur out of bounds. This is a very slow and resource hungry mode and as such we do not recommend you enable it by default during development but instead when you are trying to track the cause of a memory stomp only.</li>
</ul>
<p>Use the following to dump all allocations to a file (note that this requires <a class="el" href="struct_ak_mem_settings_ae97967db68ec10e8410af9f776f89e0d.html#ae97967db68ec10e8410af9f776f89e0d" title="Default 0 disabled. 1 debug enabled. 2 stomp allocator enabled. 3 stomp allocator and debug enabled....">AkMemSettings::uMemoryDebugLevel</a> to be 1 and a non Release configuration):</p>
<ul>
<li><a class="el" href="namespace_a_k_1_1_memory_mgr_a4f48ed6707ab2f2341f4a81f1c6053d7.html#a4f48ed6707ab2f2341f4a81f1c6053d7">AK::MemoryMgr::DumpToFile</a></li>
</ul>
<p>Remark: The sound engine opens a stream for writing using <a class="el" href="class_a_k_1_1_i_ak_stream_mgr_a1de2a7935a2d3cddb71e7cc7f48effd6.html#a1de2a7935a2d3cddb71e7cc7f48effd6">AK::IAkStreamMgr::CreateStd()</a>. If you are using the default implementation of the Stream Manager, file opening is executed in your implementation of the Low-Level IO interface <a class="el" href="namespace_a_k_1_1_sound_engine_1_1_dynamic_sequence_ae1255816f8ed9f3e1020f2075f12c690.html#ae1255816f8ed9f3e1020f2075f12c690">AK::StreamMgr::IAkLowLevelIOHook::Open()</a>.</p>
<p>Use the following settings to perform tracking of allocations for debugging purposes (these will not be called in the Release configuration):</p>
<ul>
<li><a class="el" href="struct_ak_mem_settings_aa7ad0e0dd66eaf23d3721301fc516be6.html#aa7ad0e0dd66eaf23d3721301fc516be6" title="(Optional) Memory allocation debugging hook. Used for tracking calls to pfMalloc.">AkMemSettings::pfDebugMalloc</a></li>
<li><a class="el" href="struct_ak_mem_settings_ab590383aaeabbb4d198151f9041f7517.html#ab590383aaeabbb4d198151f9041f7517" title="(Optional) Memory allocation debugging hook. Used for tracking calls to pfMalign.">AkMemSettings::pfDebugMalign</a></li>
<li><a class="el" href="struct_ak_mem_settings_ad1a6c086b143f9a84de67a552b2a63dd.html#ad1a6c086b143f9a84de67a552b2a63dd" title="(Optional) Memory allocation debugging hook. Used for tracking calls to pfRealloc.">AkMemSettings::pfDebugRealloc</a></li>
<li><a class="el" href="struct_ak_mem_settings_ac50c4db30282223a2de087fc2d40b88c.html#ac50c4db30282223a2de087fc2d40b88c" title="(Optional) Memory allocation debugging hook. Used for tracking calls to pfFree.">AkMemSettings::pfDebugFree</a></li>
<li>AkMemSettings::pfDebugCheckForOverwrite</li>
</ul>
<p>The debug functions above do not replace the actual allocation functions below; they are notification callbacks for the various memory allocation events.</p>
<p>Use the following settings to override the default implementation's use of rpmalloc with a custom allocator:</p>
<ul>
<li><a class="el" href="struct_ak_mem_settings_a64de7db44eeaaf01011d473529667b7d.html#a64de7db44eeaaf01011d473529667b7d" title="(Optional) Thread-specific allocator initialization hook.">AkMemSettings::pfInitForThread</a></li>
<li><a class="el" href="struct_ak_mem_settings_adec2f9a28716236a5e1b2c7a258b8c6e.html#adec2f9a28716236a5e1b2c7a258b8c6e" title="(Optional) Thread-specific allocator termination hook.">AkMemSettings::pfTermForThread</a></li>
<li><a class="el" href="struct_ak_mem_settings_afbf907696820f2fd30f88af36620bdd8.html#afbf907696820f2fd30f88af36620bdd8" title="(Optional) Thread-specific allocator &quot;trimming&quot; hook. Used to relinquish memory resources when thread...">AkMemSettings::pfTrimForThread</a></li>
<li><a class="el" href="struct_ak_mem_settings_a7b0974f6f5480a8fd549d5350b960079.html#a7b0974f6f5480a8fd549d5350b960079" title="(Optional) Memory allocation hook.">AkMemSettings::pfMalloc</a></li>
<li><a class="el" href="struct_ak_mem_settings_a71352af10d5b691094fb319ab5e36b38.html#a71352af10d5b691094fb319ab5e36b38" title="(Optional) Memory allocation hook.">AkMemSettings::pfMalign</a></li>
<li><a class="el" href="struct_ak_mem_settings_a6ccdc83c31c9dfdc5b9d22423bd7aee9.html#a6ccdc83c31c9dfdc5b9d22423bd7aee9" title="(Optional) Memory allocation hook.">AkMemSettings::pfRealloc</a></li>
<li><a class="el" href="struct_ak_mem_settings_a3acf39bd77470f4b6adf8441b5f8ddd2.html#a3acf39bd77470f4b6adf8441b5f8ddd2" title="(Optional) Memory allocation hook.">AkMemSettings::pfFree</a></li>
<li><a class="el" href="struct_ak_mem_settings_ad1f86b301a24dceb8622a9ee74466bcb.html#ad1f86b301a24dceb8622a9ee74466bcb" title="(Optional) Memory allocation statistics hook.">AkMemSettings::pfTotalReservedMemorySize</a></li>
<li><a class="el" href="struct_ak_mem_settings_a27eaf83daea702267d7d71e734cba836.html#a27eaf83daea702267d7d71e734cba836" title="(Optional) Memory allocation statistics hook.">AkMemSettings::pfSizeOfMemory</a></li>
</ul>
<p>It is important for the allocation functions above to honor the AkMemType_Device bit by returning device memory when the bit is set. Device memory allocation is used on certain platforms only, and must conform to specific parameters: refer to the platform-specific section for details.</p>
<p>Use the following settings to override or control the page allocation mechanism underlying rpmalloc:</p>
<ul>
<li><a class="el" href="struct_ak_mem_settings_ab6363612f82f9ba6b13494a460b45988.html#ab6363612f82f9ba6b13494a460b45988" title="Virtual page allocation hook.">AkMemSettings::pfAllocVM</a></li>
<li><a class="el" href="struct_ak_mem_settings_a64cb0abc5d03d86844ae9279c836e67d.html#a64cb0abc5d03d86844ae9279c836e67d" title="Virtual page allocation hook.">AkMemSettings::pfFreeVM</a></li>
<li><a class="el" href="struct_ak_mem_settings_a07c8f1e45eb8a6768fef0ae455d3609b.html#a07c8f1e45eb8a6768fef0ae455d3609b" title="Device page allocation hook.">AkMemSettings::pfAllocDevice</a></li>
<li><a class="el" href="struct_ak_mem_settings_af5e1c3b9df9b023290324c2f435fc26f.html#af5e1c3b9df9b023290324c2f435fc26f" title="Device page allocation hook.">AkMemSettings::pfFreeDevice</a></li>
<li><a class="el" href="struct_ak_mem_settings_ac0c81404510c577877b2bba1c143ff92.html#ac0c81404510c577877b2bba1c143ff92" title="Virtual memory page size. Defaults to 0 which means auto-detect.">AkMemSettings::uVMPageSize</a></li>
<li><a class="el" href="struct_ak_mem_settings_addef8a52e74335e4009eb632f6ace404.html#addef8a52e74335e4009eb632f6ace404" title="Device memory page size. Defaults to 0 which means auto-detect.">AkMemSettings::uDevicePageSize</a></li>
<li><a class="el" href="struct_ak_mem_settings_a872fb3181e773031406335d39f94dedb.html#a872fb3181e773031406335d39f94dedb" title="All memory allocations of sizes larger than this value will go to a global heap shared across all thr...">AkMemSettings::uMaxThreadLocalHeapAllocSize</a></li>
</ul>
<p>The functions above will not be called if a custom allocator is configured to override rpmalloc. Device memory allocation is used on certain platforms only, and must conform to specific parameters: refer to the platform-specific section for details. If the alignment of the returned memory does not correspond to the natural alignment of the platform (for example, 64KB on Windows), this custom alignment must be specified in uVMPageSize and uDevicePageSize.</p>
<p>On threads that have called <a class="el" href="namespace_a_k_1_1_memory_mgr_a76b450a2f472f5d9bc61aa1c3ed9a722.html#a76b450a2f472f5d9bc61aa1c3ed9a722">AK::MemoryMgr::InitForThread()</a>, any allocation smaller than uMaxThreadLocalHeapAllocSize goes to a thread-local heap. Any allocation larger than that value go to a global heap, which is shared by all threads. The default value of uMaxThreadLocalHeapAllocSize is 0, so by default, all allocations go to the global heap. During periods of heavy multi-threaded CPU activity, there might be significant levels of contention for access to the global heap. If this occurs, consider setting uMaxThreadLocalHeapAllocSize to a value such as 384 or 512 or higher in order to mitigate the CPU contention, at the cost of greater memory use.</p>
<p>Refer to <a class="el" href="samplecode.html">Samples</a> for sample code and more information regarding the initialization of the Memory Manager in your game.</p>
<p>Refer to <a class="el" href="soundengine_banks_loading.html">Loading Banks</a> for more information regarding SoundBank memory usage.</p>
<p>Refer to <a class="el" href="goingfurther_optimizingmempools.html">Optimizing Memory Allocation</a> for information about optimizing memory allocation.</p>
<h1><a class="anchor" id="overridememorymanager"></a>
Overriding the memory manager</h1>
<p>It is possible for a client to provide a custom implementation of the <a class="el" href="namespace_a_k_1_1_memory_mgr.html">AK::MemoryMgr</a> interface. All functions defined in <a class="el" href="_ak_memory_mgr_8h.html">AkMemoryMgr.h</a> should be implemented. The functions from the <a class="el" href="namespace_a_k_1_1_memory_mgr.html">AK::MemoryMgr</a> namespace defined in <a class="el" href="_ak_module_8h.html">AkModule.h</a> do not need to be implemented as they are specific to the default implementation of the memory manager.</p>
<p>As when overriding the various allocation functions of <code><a class="el" href="struct_ak_mem_settings.html">AkMemSettings</a></code>, when writing a new <a class="el" href="namespace_a_k_1_1_memory_mgr.html">AK::MemoryMgr</a> implementation care must be taken to honor the AkMemType_Device bit by returning device memory when the bit is set. Device memory allocation is used on certain platforms only, and must conform to specific parameters: refer to the platform-specific section for details. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</body>
</html>
