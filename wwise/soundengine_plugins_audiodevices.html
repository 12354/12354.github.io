<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Creating Audio Device (Sink) Plug-ins</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="akdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Wwise SDK 2023.1.0 - Windows
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Creating Audio Device (Sink) Plug-ins </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="se_audiodevice"></a>
Audio Device Plug-in Interface Implementation</h1>
<p>Audio device plug-ins are the endpoints of the audio processing chain. Natural Audio devices are the OS sound systems, but there can be more possible outputs if additional hardware or drivers allow it. The role of the sink plug-in is to take the final mixed audio samples and transfer them to the device, in the format the device understands.</p>
<h2><a class="anchor" id="se_audiodevice_engine"></a>
Sound Engine Component</h2>
<p>On the sound engine side, writing an audio device plug-in consists of implementing the <code><a class="el" href="class_a_k_1_1_i_ak_sink_plugin.html" title="Software interface for sink (audio endpoint) plugins.">AK::IAkSinkPlugin</a></code> interface. Only the functions specific to this interface are covered there. Refer to <a class="el" href="soundengine_plugins.html">Creating Sound Engine Plug-ins</a> for information about interface components shared with other plug-in types ( <code><a class="el" href="class_a_k_1_1_i_ak_plugin.html">AK::IAkPlugin</a></code> interface). Also refer to the provided AkSink plug-in for sample code (<a class="el" href="samplecode.html">Samples</a>).</p>
<p>An audio device is always specified through the plug-in it is using (Audio Device ShareSet) and a specific device ID. This device ID has no meaning for the Wwise sound engine, it is for the sole purpose of the plug-in implementor to discriminate devices where many of the same type exists. It is passed by the game through the <code>AkOutputSettings::idDevice</code> parameter used in <code>AK::SoundEngine::Init</code> and <code>AK::SoundEngine::AddOutput</code>. For example, an audio device plug-in which would access Windows' audio devices could probably see many Windows' devices on a particular computer. <br  />
</p>
<p>If your device doesn't need to discriminate between multiple devices, you can ignore that parameter. However, if you need to implement this, be aware that you MUST also support the "default device" concept, which is selected when the <code>idDevice</code> parameter is <code>0</code>. Whether the first available device or a specific device is selected when receiving <code>0</code> is up to the plug-in programmer.</p>
<p>Sink plug-ins can register an extra static function to support enumeration of available audio devices. The purpose of this function is to fill the possible devices a user can select in the authoring tool as well as to allow device enumeration at run-time through calls to <code>AK::SoundEngine::GetDeviceList</code>. This function is optional. If not implemented, it is expected that the plug-in will initialize to a "default" output when required. If necessary, the additional static function should be provided after the plug-in parameter creation function. For more information on other static functions to provide for plug-in creation, see <a class="el" href="soundengine_plugins.html">Creating Sound Engine Plug-ins</a>.</p>
<p>Below is an example implementation of device enumeration for a fictitious sink plug-in, MyPlugin. Note that functions and classes in the MyPlugin namespace are placeholders for actual plug-in implementations.</p>
<p><code>The</code> plug-in device enumeration will be called by Wwise with the maximum number of devices to fill and a pre-allocated array of <code><a class="el" href="struct_ak_device_description.html">AkDeviceDescription</a></code>. The maximum length of the device name is <code>AK_MAX_PATH</code> (256 characters). You must modify the count (<code>io_maxNumDevices</code>) to reflect the number of device descriptions correctly filled. If the provided device description array pointer is null, the count should still be modified to reflect the number of device descriptions that would be filled, so that the caller can allocate an appropriate amount of memory for <code>out_deviceDescriptions</code>.</p>
<div class="fragment"><div class="line"><span class="comment">// ...</span></div>
<div class="line"> </div>
<div class="line">AKRESULT GetMyPluginDeviceList(AkUInt32&amp; io_maxNumDevices, <a class="code" href="struct_ak_device_description.html">AkDeviceDescription</a>* out_deviceDescriptions)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// For example, fetch the available devices</span></div>
<div class="line">    <span class="keyword">const</span> AkUInt32 deviceCount = MyPlugin::GetNumberOfDevices();</div>
<div class="line">    <span class="keyword">const</span> MyPlugin::Device* devices = MyPlugin::GetDevices();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Handle device count requests:</span></div>
<div class="line">    <span class="comment">// If out_deviceDescriptions is NULL, io_maxNumDevices should be set to the device count</span></div>
<div class="line">    <span class="comment">// so the caller can determine how much memory to reserve.</span></div>
<div class="line">    <span class="keywordflow">if</span> (out_deviceDescriptions == NULL)</div>
<div class="line">    {</div>
<div class="line">        io_maxNumDevices = deviceCount;</div>
<div class="line">        <span class="keywordflow">return</span> AK_Success;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// else, fill out_deviceDescriptions</span></div>
<div class="line">    <span class="comment">// until all available devices are filled (i == deviceCount)</span></div>
<div class="line">    <span class="comment">// or the end of the array is reached (i == io_maxNumDevices)</span></div>
<div class="line">    <span class="keywordtype">int</span> i = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (; i &lt; deviceCount &amp;&amp; i &lt; io_maxNumDevices; ++i)</div>
<div class="line">    {</div>
<div class="line">        AKPLATFORM::SafeStrCpy(out_deviceDescriptions[i].deviceName, device[i]-&gt;deviceName, AK_MAX_PATH);</div>
<div class="line">        out_deviceDescriptions[i].idDevice = devices[i].idDevice;</div>
<div class="line">        out_deviceDescriptions[i].deviceStateMask = devices[i].deviceStateMask;</div>
<div class="line">        out_deviceDescriptions[i].isDefaultDevice = devices[i].isDefaultDevice;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set the number of devices written into the array</span></div>
<div class="line">    io_maxNumDevices = i;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> AK_Success;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Static initializer object to automatically register the plug-in in the sound engine.</span></div>
<div class="line"><a class="code" href="class_a_k_1_1_plugin_registration.html">AK::PluginRegistration</a> MyPluginRegistration(AkPluginTypeEffect, AKCOMPANYID_MYCOMPANY, EFFECTID_MYPLUGIN, CreateMyPlugin, CreateMyPluginParams, GetMyPluginDeviceList);</div>
</div><!-- fragment --><table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> This sound engine implementation replaces the previous authoring only plug-in equivalent <code>AkGetSinkPluginDevices</code> so that device enumeration can be implemented for all supported platforms and can be called at run-time through <code>AK::SoundEngine::GetDeviceList</code>. </td></tr>
</table>
<table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> This function will be compiled on all platforms. To handle platform specific device enumeration, one should use the appropriate macros (e.g. <code>AK_WIN</code>, <code>AK_LINUX</code>, etc.) and return <code>AK_NotImplemented</code> on platforms for which no implementation is defined. </td></tr>
</table>
<h2><a class="anchor" id="se_audiodevice_authoring"></a>
Authoring DLL for an Audio Device Plug-in</h2>
<p>As with any other plug-in, sink plug-ins need an authoring DLL counterpart. Please refer to <a class="el" href="plugin_dll.html">Authoring Plug-in Library Format</a> for the basic setup of the Wwise authoring component common to all plug-ins.</p>
<table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> <code>AkGetSinkPluginDevices</code> is now deprecated, see the Sound Engine Component section above to implement device enumeration. </td></tr>
</table>
<h2><a class="anchor" id="se_audiodevice_testing"></a>
Testing your Audio Device Plug-in</h2>
<p>After implementing the Wwise part of the plug-in (<a class="el" href="effectpluginwwise.html">Writing the Authoring Part of an Audio Plug-in</a>) and the sound engine part, you can test your plug-in following these steps:</p><ul>
<li>In your Wwise Project, create an Audio Device ShareSet using your new plug-in. Give the ShareSet a unique name.</li>
<li>Generate you banks.</li>
<li>Make sure your plug-in was registered in your game code. See Sound Engine Plug-ins Overview.</li>
<li>Specify your audio device ID to be used in the initialization parameters of the sound engine. The ID in the <a class="el" href="struct_ak_output_settings.html" title="Platform-independent initialization settings of output devices.">AkOutputSettings</a> is the hash of the name of the Audio Device ShareSet in the project, as given by <code>AK::SoundEngine::GetIDFromString</code>.</li>
</ul>
<p>For example: </p><div class="fragment"><div class="line"><a class="code" href="struct_ak_init_settings.html">AkInitSettings</a> initSettings;</div>
<div class="line"><a class="code" href="struct_ak_platform_init_settings.html">AkPlatformInitSettings</a> platformInitSettings;</div>
<div class="line">AK::SoundEngine::GetDefaultInitSettings( initSettings );</div>
<div class="line">AK::SoundEngine::GetDefaultPlatformInitSettings( platformInitSettings );</div>
<div class="line"> </div>
<div class="line">initSettings.settingsMainOutput.audioDeviceShareset = AK::SoundEngine::GetIDFromString(<span class="stringliteral">&quot;YourNewAudioDeviceSharesetNameHere&quot;</span>);</div>
<div class="line"> </div>
<div class="line">AK::SoundEngine::Init( &amp;initSettings, &amp;platformInitSettings );</div>
</div><!-- fragment --><p>Alternatively, you can use your Audio Device plug-in with <code>AK::SoundEngine::AddOutput</code>.</p>
<div class="fragment"><div class="line"><a class="code" href="struct_ak_output_settings.html">AkOutputSettings</a> outputSettings(<span class="stringliteral">&quot;YourNewAudioDeviceSharesetNameHere&quot;</span>, 0 <span class="comment">/*Default device*/</span>)<span class="stringliteral">&#39;</span></div>
<div class="line"><span class="stringliteral">AK::SoundEngine::AddOutput(outputSettings);</span></div>
</div><!-- fragment --><p>You can test device enumeration for your plug-in with <code>AK::SoungEngine::GetDeviceList</code>.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">int</span> maxNbDevices = 20;</div>
<div class="line"><a class="code" href="struct_ak_device_description.html">AkDeviceDescription</a> devices[maxNbDevices];</div>
<div class="line"> </div>
<div class="line">AkUInt32 deviceCount = maxNbDevices;</div>
<div class="line">AKRESULT res = AK::SoundEngine::GetDeviceList(</div>
<div class="line">    AK::SoundEngine::GetIDFromString(<span class="stringliteral">&quot;YourNewAudioDeviceSharesetNameHere&quot;</span>),</div>
<div class="line">    deviceCount,</div>
<div class="line">    devices</div>
<div class="line">);</div>
</div><!-- fragment --><p>For more information, refer to the following sections:</p><ul>
<li>Sound Engine Plug-ins Overview</li>
<li><a class="el" href="effectpluginwwise.html">Writing the Authoring Part of an Audio Plug-in</a></li>
<li><a class="el" href="samplecode.html">Samples</a> </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="astruct_ak_init_settings_a9c5254abf13a5c3bf60ddd27c48db4d7_html_a9c5254abf13a5c3bf60ddd27c48db4d7"><div class="ttname">AkInitSettings::settingsMainOutput</div><div class="ttdeci">AkOutputSettings settingsMainOutput</div><div class="ttdoc">Main output device settings.</div><div class="ttdef"><b>Definition:</b> AkSoundEngine.h:229</div></div>
<div class="ttc" id="astruct_ak_device_description_a55fa0c44cdb0b7443ecb2df6c869cba5_html_a55fa0c44cdb0b7443ecb2df6c869cba5"><div class="ttname">AkDeviceDescription::deviceStateMask</div><div class="ttdeci">AkAudioDeviceState deviceStateMask</div><div class="ttdoc">Bitmask used to filter the device based on their state.</div><div class="ttdef"><b>Definition:</b> AkTypes.h:323</div></div>
<div class="ttc" id="anamespace_a_k_1_1_sound_engine_a9a26da64092b97243844df77cbcdbf5f_html_a9a26da64092b97243844df77cbcdbf5f"><div class="ttname">AK::SoundEngine::Init</div><div class="ttdeci">AKSOUNDENGINE_API AKRESULT Init(AkInitSettings *in_pSettings, AkPlatformInitSettings *in_pPlatformSettings)</div></div>
<div class="ttc" id="astruct_ak_platform_init_settings_html"><div class="ttname"><a href="struct_ak_platform_init_settings.html">AkPlatformInitSettings</a></div><div class="ttdef"><b>Definition:</b> AkWinSoundEngine.h:45</div></div>
<div class="ttc" id="astruct_ak_device_description_aff286ff755788f1997fc4bf34846824f_html_aff286ff755788f1997fc4bf34846824f"><div class="ttname">AkDeviceDescription::isDefaultDevice</div><div class="ttdeci">bool isDefaultDevice</div><div class="ttdoc">Identify default device. Always false when not supported.</div><div class="ttdef"><b>Definition:</b> AkTypes.h:324</div></div>
<div class="ttc" id="a_common_2_ak_types_8h_a64f7d1f79613cc4dcc49a4efba6caa63_html_a64f7d1f79613cc4dcc49a4efba6caa63"><div class="ttname">AKRESULT</div><div class="ttdeci">AKRESULT</div><div class="ttdoc">Standard function call result.</div><div class="ttdef"><b>Definition:</b> AkTypes.h:213</div></div>
<div class="ttc" id="a_common_2_ak_types_8h_a1a77eb101e82e7d712f25e2a6394ac4c_html_a1a77eb101e82e7d712f25e2a6394ac4ca2971cc4c818bf62c55175445d2be117d"><div class="ttname">AkPluginTypeEffect</div><div class="ttdeci">@ AkPluginTypeEffect</div><div class="ttdoc">Effect plug-in: applies processing to audio data.</div><div class="ttdef"><b>Definition:</b> AkTypes.h:1253</div></div>
<div class="ttc" id="astruct_ak_output_settings_html"><div class="ttname"><a href="struct_ak_output_settings.html">AkOutputSettings</a></div><div class="ttdoc">Platform-independent initialization settings of output devices.</div><div class="ttdef"><b>Definition:</b> AkSoundEngine.h:116</div></div>
<div class="ttc" id="a_common_2_ak_types_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname">NULL</div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> AkTypes.h:46</div></div>
<div class="ttc" id="a_common_2_ak_types_8h_a64f7d1f79613cc4dcc49a4efba6caa63_html_a64f7d1f79613cc4dcc49a4efba6caa63ad7c47fea3da641e7422573c6a13dc35e"><div class="ttname">AK_Success</div><div class="ttdeci">@ AK_Success</div><div class="ttdoc">The operation was successful.</div><div class="ttdef"><b>Definition:</b> AkTypes.h:215</div></div>
<div class="ttc" id="anamespace_a_k_1_1_sound_engine_a03381fc17e1b0ee16c2ab501c647ab9e_html_a03381fc17e1b0ee16c2ab501c647ab9e"><div class="ttname">AK::SoundEngine::GetDefaultInitSettings</div><div class="ttdeci">AKSOUNDENGINE_API void GetDefaultInitSettings(AkInitSettings &amp;out_settings)</div></div>
<div class="ttc" id="aclass_a_k_1_1_plugin_registration_html"><div class="ttname"><a href="class_a_k_1_1_plugin_registration.html">AK::PluginRegistration</a></div><div class="ttdef"><b>Definition:</b> IAkPlugin.h:1762</div></div>
<div class="ttc" id="a_platforms_2_windows_2_ak_types_8h_ac1096fa0921ee445f47e145c167eab4b_html_ac1096fa0921ee445f47e145c167eab4b"><div class="ttname">AK_MAX_PATH</div><div class="ttdeci">#define AK_MAX_PATH</div><div class="ttdoc">Maximum path length.</div><div class="ttdef"><b>Definition:</b> AkTypes.h:126</div></div>
<div class="ttc" id="anamespace_a_k_1_1_sound_engine_aecdb9cd8f2d7f461ef1a58f5f5f5725d_html_aecdb9cd8f2d7f461ef1a58f5f5f5725d"><div class="ttname">AK::SoundEngine::GetDefaultPlatformInitSettings</div><div class="ttdeci">AKSOUNDENGINE_API void GetDefaultPlatformInitSettings(AkPlatformInitSettings &amp;out_platformSettings)</div></div>
<div class="ttc" id="anamespace_a_k_p_l_a_t_f_o_r_m_aebd4566f4b4cc51c94ab69c3272b5991_html_aebd4566f4b4cc51c94ab69c3272b5991"><div class="ttname">AKPLATFORM::SafeStrCpy</div><div class="ttdeci">void SafeStrCpy(wchar_t *in_pDest, const wchar_t *in_pSrc, size_t in_uDestMaxNumChars)</div><div class="ttdoc">Safe unicode string copy.</div><div class="ttdef"><b>Definition:</b> AkPlatformFuncs.h:453</div></div>
<div class="ttc" id="anamespace_a_k_1_1_sound_engine_a1aae6ebdec25946fb2897ce0e025366d_html_a1aae6ebdec25946fb2897ce0e025366d"><div class="ttname">AK::SoundEngine::GetIDFromString</div><div class="ttdeci">AKSOUNDENGINE_API AkUInt32 GetIDFromString(const char *in_pszString)</div></div>
<div class="ttc" id="astruct_ak_device_description_html"><div class="ttname"><a href="struct_ak_device_description.html">AkDeviceDescription</a></div><div class="ttdef"><b>Definition:</b> AkTypes.h:320</div></div>
<div class="ttc" id="astruct_ak_output_settings_af1ff3ac68f3fa137c847144117d01535_html_af1ff3ac68f3fa137c847144117d01535"><div class="ttname">AkOutputSettings::audioDeviceShareset</div><div class="ttdeci">AkUniqueID audioDeviceShareset</div><div class="ttdef"><b>Definition:</b> AkSoundEngine.h:129</div></div>
<div class="ttc" id="a_ak_numeral_types_8h_a39c6c5d577901802ca77775760b704ce_html_a39c6c5d577901802ca77775760b704ce"><div class="ttname">AkUInt32</div><div class="ttdeci">uint32_t AkUInt32</div><div class="ttdoc">Unsigned 32-bit integer.</div><div class="ttdef"><b>Definition:</b> AkNumeralTypes.h:38</div></div>
<div class="ttc" id="astruct_ak_init_settings_html"><div class="ttname"><a href="struct_ak_init_settings.html">AkInitSettings</a></div><div class="ttdef"><b>Definition:</b> AkSoundEngine.h:215</div></div>
<div class="ttc" id="anamespace_a_k_1_1_sound_engine_a3de19a0cdec459ebdc73fc1d0f8f276e_html_a3de19a0cdec459ebdc73fc1d0f8f276e"><div class="ttname">AK::SoundEngine::GetDeviceList</div><div class="ttdeci">AKSOUNDENGINE_API AKRESULT GetDeviceList(AkUInt32 in_ulCompanyID, AkUInt32 in_ulPluginID, AkUInt32 &amp;io_maxNumDevices, AkDeviceDescription *out_deviceDescriptions)</div></div>
<div class="ttc" id="astruct_ak_device_description_a5e1be4d07a51040ccc6ff04a38e7d47c_html_a5e1be4d07a51040ccc6ff04a38e7d47c"><div class="ttname">AkDeviceDescription::idDevice</div><div class="ttdeci">AkUInt32 idDevice</div><div class="ttdoc">Device ID for Wwise. This is the same as what is returned from AK::GetDeviceID and AK::GetDeviceIDFro...</div><div class="ttdef"><b>Definition:</b> AkTypes.h:321</div></div>
</body>
</html>

