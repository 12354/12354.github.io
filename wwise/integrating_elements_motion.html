<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Integrating Wwise Motion</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="akdoxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Wwise SDK 2023.1.0 - Windows
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Integrating Wwise Motion </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>You can use Motion plug-ins to control the haptic feedback of a control interface. With Wwise, you can use the same set of tools to manage motion and audio in your application. Internally, motion data is no different than audio data, and all the features available for audio are also available for motion. Two types of haptic feedback are available through the motion feature: you can transform any audio signals in your project and into motion, or generate dedicated motion signals with the Motion source. You can test motion directly in Wwise Authoring on Windows with a supported controller.</p>
<h1><a class="anchor" id="motion_components"></a>
Motion Components</h1>
<p>Motion uses the Wwise Sound Engine plug-in system to work in an application, and can be subdivided into two modules: the audio source called <em>Motion</em> and the Audio Device called <em>Wwise Motion</em>. Although the Motion audio source is optional, it remains a powerful tool to create accurate and flexible motion designs.</p>
<h2><a class="anchor" id="motion_sink_plungin_component"></a>
Wwise Motion Audio Device Plug-in</h2>
<p>The Wwise Motion audio device plug-in links the sound engine to motion-ready devices. Just like any audio device plug-in, it receives data from a set of Listeners and "presents" this data to a device. This plug-in is inside a separate library and needs to be included in both Wwise Authoring and the application. Refer to the Setting Up Motion section for more information.</p>
<h2><a class="anchor" id="motion_source_component"></a>
Motion Source Plug-in</h2>
<p>You can use the Motion source plug-in to design the behavior of haptic feedback effects. Just like any audio source, you can add a Motion source plug-in to a Sound SFX node in your Wwise project. Make sure that the Sound SFX nodes have Output Busses set to motion-ready busses. See Motion for more information.</p>
<h1><a class="anchor" id="setup_motion"></a>
Setting Up Motion</h1>
<p>To use motion in your application, you need to properly set up each component. All the concepts applicable to the audio workflow are also applicable to motion. It uses the same busses, Listeners, and Emitters (see <a class="el" href="soundengine_listeners.html">Integrating Listeners</a>).</p>
<h2><a class="anchor" id="motion_authoring_setup"></a>
Wwise Authoring Setup</h2>
<p>To be able to send either sound or motion data to a device, you need to add the licensed Wwise Motion Audio Device to the Audio Device folder of your Wwise project, located in the Audio tab of the Project Explorer. The Wwise Motion Audio Device is the plug-in used by the sound engine to interface with a motion-ready device. It is also crucial to assign the Wwise Motion Audio Device to a top level Audio Bus. <b>The term <em>motion bus</em> denotes a top-level Audio Bus with a Wwise Motion Audio Device assigned to it.</b> It is good practice to use a single motion bus hierarchy in your project for easier troubleshooting and monitoring. You can then set the Output Bus of any Sound SFX to a motion bus to create haptic feedback. Usually the Sound SFX elements that use a motion bus also use a Motion source. To simultaneously have audio and motion, a Sound SFX needs to have at least one motion bus and one Audio Bus, either as the Output Bus or as an Auxiliary Bus.</p>
<h2><a class="anchor" id="motion_application_setup"></a>
Game Setup</h2>
<p>On the game side, link with the separate library called <code>AkMotionSink</code>. This library provides support for the standard controllers of supported platforms. You also need to include the <a class="el" href="_ak_motion_sink_factory_8h.html">AkMotionSinkFactory.h</a> file, located under <code>SDK\include\<a class="el" href="namespace_a_k.html" title="Audiokinetic namespace.">AK</a>\plugin</code>. It is important to include this file because it automatically registers the plug-in.</p>
<table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> In Unity and Unreal, plug-in libraries are managed automatically. You don't have to add <code>AkMotionSink</code> manually. </td></tr>
</table>
<p>Refer to the following table for the list of supported controllers and additional requirements.</p>
<table align="center" border="1">
<tr>
<td>Platform</td><td>Device</td><td>Device Channel Config and Layout</td><td>Additional Requirements  </td></tr>
<tr>
<td>Windows</td><td>Xbox and XInput-compatible Controllers<br  />
DirectInput-compatible Controllers</td><td>Anonymous 2-channel:<br  />
Left motor, right motor</td><td>XInput.lib<br  />
Dinput8.lib<br  />
Winmm.lib  </td></tr>
</table>
<p><br  />
 If your application uses motion with one or more devices, you must add a dedicated output for each device. For example, a split-screen game with four players connected needs four different outputs for the controllers to receive haptic feedback. To add an output device, use the Wwise API's <code>AK::SoundEngine::AddOutput</code> function and specify the ShareSet name (as defined in your Wwise project) in the <code><a class="el" href="struct_ak_output_settings.html" title="Platform-independent initialization settings of output devices.">AkOutputSettings</a></code> parameter. Additionally, because multiple devices can be connected, you need to provide a device ID. The following table contains more information about device IDs.</p>
<table align="center" border="1">
<tr>
<td>Platform</td><td>Device</td><td>Information  </td></tr>
<tr>
<td>Windows</td><td>Xbox and XInput-compatible Controllers</td><td>Use the player index between 0 to 3.   </td></tr>
<tr>
<td>Windows</td><td>DirectInput-compatible Controllers</td><td>Use the guidProduct stored in a DIDEVICEINSTANCE. Hash the guidProduct by using an <code>AK::FNVHash32</code>.   </td></tr>
</table>
<p><br  />
 </p><table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> On all platforms except Windows, a device ID of "0" targets the first available device that supports motion. </td></tr>
</table>
<p>Remember that game controllers can be disconnected either physically or due to communication problems. Disconnection does not have any adverse effects on the sound engine other than needlessly using resources. If you think a device has been disconnected for a long time, call <code>AK::SoundEngine::RemoveOutput</code> and provide the <code>AkOutputDeviceID</code> returned by the corresponding <code>AddOutput()</code> function call.</p>
<h1><a class="anchor" id="motion_single_vs_multiple"></a>
Multiplayer Considerations</h1>
<p>Motion outputs are like any other Secondary Outputs and therefore have the same restrictions and requirements. If you are making a single-player game, in which only one player controls the game locally, the Listener/Game Object setup is very simple. In normal cases, the new motion output re-uses the same default Listener as the main audio output. In other words, you rarely have to manage Listeners in a single-player setup.</p>
<p>For multiplayer games, you must create one Listener/Game Object for each motion output. This is necessary so that each player has their own mix of haptic feedback, depending on the situation in the game. The Listener associated with a device must be initialized at the same time as the output is initialized by <code>AK::SoundEngine::AddOutput()</code>. Specific Listeners provide an additional layer of routing for sounds or motion. You can target a specific player if you play an Event on a Game Object that is uniquely associated with that player's Listener. To establish this association, you can call <code>AK::SoundEngine::SetListeners</code>. You can also associate multiple listeners with the same game object, which has a "broadcast" effect on all listeners. See <a class="el" href="soundengine_listeners.html">Integrating Listeners</a> for more information about Listeners and Game Objects.</p>
<table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> A sound needs to be routed into the motion bus hierarchy even if the Emitter has a Listener set to a motion output. </td></tr>
</table>
<h1><a class="anchor" id="motion_example"></a>
Examples</h1>
<p>The following examples demonstrate how to set up your application to use motion. You can also refer to the Demo Motion example in the Integration Demo (DemoMotion.cpp) included in the SDK samples. It provides working examples for all the supported platforms.</p>
<h2><a class="anchor" id="single_player_setup"></a>
Setup for a single player</h2>
<p>First, as with any other plug-in, you need to include the corresponding file and link the library (for Wwise native development only, not required for Unity). </p><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="_ak_motion_sink_factory_8h.html">AkMotionSinkFactory.h</a>&quot;</span>            <span class="comment">//Link to AkMotionSink.lib, implements the output to ga</span></div>
</div><!-- fragment --><p>Next, add another output with the Wwise Motion Audio Device ShareSet name from the Wwise project, in this case "Wwise_Motion". The output ID is 0 to ensure that the first connected game controller is used.</p>
<div class="fragment"><div class="line"><a class="code" href="struct_ak_output_settings.html">AkOutputSettings</a> outputSettings(<span class="stringliteral">&quot;Wwise_Motion&quot;</span>, 0); </div>
<div class="line">AK::SoundEngine::AddOutput(outputSettings);</div>
</div><!-- fragment --><p>Next, play an Event. In the Wwise project, the "Play_Explosion" Event is linked to a Sound SFX that is routed to a bus that has "Wwise_Motion" ShareSet assigned as its Audio Device. </p><div class="fragment"><div class="line">AkGameObjectID explosionGO = 100;</div>
<div class="line">AK::SoundEngine::RegisterGameObj(explosionGO, <span class="stringliteral">&quot;Explosion&quot;</span>);</div>
<div class="line">AK::SoundEngine::PostEvent(<span class="stringliteral">&quot;Play_Explosion&quot;</span>, explosionGO);</div>
</div><!-- fragment --><h2><a class="anchor" id="multiplayer_setup"></a>
Setup for multiple players</h2>
<p>This section describes how to set up motion for multiple players on the same console, not a networked multiplayer game. In multiplayer scenarios, the mix for motion, or any player-specific output, must be different to represent the player's perspective in the game world. Players therefore need their own Listeners.</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> NUM_PLAYERS = 4;</div>
<div class="line"><span class="keyword">const</span> AkGameObjectID OBJ_FOR_PLAYER[MAX_PLAYERS] = {100 ,200, 300, 400};    <span class="comment">// Game Object IDs are arbitrary.</span></div>
<div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; NUM_PLAYERS; i++)</div>
<div class="line">{</div>
<div class="line">    AK::SoundEngine::RegisterGameObj(OBJ_FOR_PLAYER[i]);                    <span class="comment">// Register a GameObject to use as Listener.</span></div>
<div class="line">    AK::SoundEngine::SetListeners(OBJ_FOR_PLAYER[i], &amp;OBJ_FOR_PLAYER[i], 1);    <span class="comment">// Make the Game Object listen to itself.</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Add an output for every player. You can use an Audio Device ShareSet multiple times, so you don't have to create multiple Audio Device ShareSets. You must provide a real device ID for every controller. This example is for Xbox controllers on Windows. Refer to the table in Game Setup for information on how to retrieve device IDs for specific platforms.</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> AkUInt32 DEVICE_SPECIFIC_ID[MAX_PLAYERS] = {0, 1, 2, 3};  <span class="comment">// For Xbox controllers on Windows, device IDs are simply 0 to 3. Other platforms have different requirements.</span></div>
<div class="line"><span class="keywordflow">for</span>(i = 0; i &lt; NUM_PLAYERS; i++)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="struct_ak_output_settings.html">AkOutputSettings</a> settings(<span class="stringliteral">&quot;Wwise_Motion&quot;</span>, DEVICE_SPECIFIC_ID[i]);   <span class="comment">// Use the &quot;Wwise_Motion&quot; ShareSet to drive device DEVICE_SPECIFIC_ID[i]. </span></div>
<div class="line">    res = AK::SoundEngine::AddOutput(settings, &amp;motionOutputIDs[i], &amp;OBJ_FOR_PLAYER[i], 1);  <span class="comment">// Add the output, link the appropriate Listener to it.</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>Next, play an Event. In the Wwise project, the "Play_GunFire" Event is linked to a Sound SFX that is routed to a bus that has "Wwise_Motion" assigned as its Audio Device ShareSet.</p>
<div class="fragment"><div class="line">AK::SoundEngine::PostEvent(<span class="stringliteral">&quot;Play_GunFire&quot;</span>, OBJ_FOR_PLAYER[0]);  <span class="comment">// This will play only on player&#39;s 0 controller because of the Game Object-Listener relation.</span></div>
</div><!-- fragment --><p>To play an Event that affects multiple devices, set up a new Game Object, and ensure that all player-specific Listeners listen to it.</p>
<div class="fragment"><div class="line">AK::SoundEngine::RegisterGameObj(explosionGO, <span class="stringliteral">&quot;Explosion&quot;</span>);         <span class="comment">// Register a Game Object to play an explosion.</span></div>
<div class="line">AK::SoundEngine::SetListeners(explosionGO, OBJ_FOR_PLAYER, 4);      <span class="comment">// Attach all 4 listeners of the players to the Game Object, so all can receive the Motion Effect.</span></div>
<div class="line">AK::SoundEngine::PostEvent(<span class="stringliteral">&quot;Play_Explosion&quot;</span>,explosionGO );          <span class="comment">// Because all 4 listeners are tied to the explosionGO, the Play_Explosion Event will be broadcast to all of them.</span></div>
</div><!-- fragment --><p>For an example of multiplayer setup, refer to the <code>DemoMotion</code> class in the IntegrationDemo sample.</p>
<h1><a class="anchor" id="motion_checklist_troubleshooting"></a>
Checklist and Troubleshooting</h1>
<p>For a specific device to receive motion with one device, you must:</p><ol type="1">
<li>Add a Wwise Motion Audio Device ShareSet to your project.</li>
<li>Create a top-level Audio Bus and set its Audio Device to the Wwise Motion Audio Device ShareSet you just added.</li>
<li>Create Sound SFXs and route them to the motion bus hierarchy.</li>
<li>In the game, link to the <code>AkMotionSink</code> library. Include <code><a class="el" href="_ak_motion_sink_factory_8h.html">AkMotionSinkFactory.h</a></code> and link with the <code>AkMotionSink</code> library. <table border="0" cellspacing="0" cellpadding="2">
<tr>
<td valign="top"><img src="images/Note.gif" alt="" class="inline"/></td><td><b>Note:</b> In Unity and Unreal, plug-in libraries are managed automatically. This step is unnecessary. </td></tr>
</table>
</li>
<li>Create a Game Object to call and receive motion Events with <code>AK::SoundEngine::RegisterGameObj</code>.</li>
<li>Call <code>Ak::SoundEngine::AddOutput</code> with the Wwise Motion ShareSet and a device ID. For multiplayer, provide a Listener object for each.</li>
<li>Trigger your Events the same way you do for audio Events.</li>
</ol>
<p>To add Motion to the Wwise project:</p><ol type="1">
<li>Add a Wwise Motion Audio Device ShareSet to your project.</li>
<li>Create a top-level Audio Bus and set its Audio Device to the Wwise Motion Audio Device ShareSet you just added.</li>
<li>Create Sound SFXs and route them to the motion bus hierarchy.</li>
<li>In the Audio Preferences, locate the busses you want to use motion with and, from the list, set the device of each bus to the motion device of your choice.</li>
</ol>
<h2><a class="anchor" id="motion_profiling"></a>
Profiling</h2>
<p>To troubleshoot problems, we recommend that you profile your application. In Wwise Authoring, you can profile your application as described in Profiling. Several tools can help you understand the source of a problem. The Capture Log view lists error codes in red. The Graph view displays a visual representation of the sound engine pipeline. The motion devices appear at the end of the pipeline. If no motion devices are displayed, the sound engine could not find the device you specified. Finally, the Emitter/Listener tab displays all Emitter-Listener pairs. If the Motion Effect does not work, the Emitter might not be associated with the Listener you specified for your motion device.</p>
<p>If you trigger a Motion effect but it doesn't work, do the following:</p><ul>
<li>Check the Capture Log to ensure that there are no registration errors with the plug-in. If there are, confirm that you included the <code><a class="el" href="_ak_motion_sink_factory_8h.html">AkMotionSinkFactory.h</a></code> and linked to the <code>AkMotionSink</code> library.</li>
<li>Ensure that the sound engine initialized the device. If it didn't, an error is displayed in the Capture Log when <code>AddOutput</code> is called from the game.</li>
<li>Ensure that the Sound SFX you play is routed to a bus that leads to a motion device. Check the Audio Bus property of the Sound SFX, and the Audio Device property of the bus.</li>
<li>From the Voices Graph tab, identify which Emitter triggered. Ensure that there is an associated Listener in the Emitter-Listener tab. The same Game Object can emit and listen. If there is no associated Listener, review your calls to <code>RegisterGameObj</code>, <code>SetListeners</code>, and <code>AddOutput</code>.</li>
<li>Ensure that the Listener is associated with the desired output device.</li>
<li>Review the results of any API calls you made and check for errors.</li>
</ul>
<p>For Android devices, add the permission in the application's AndroidManifest.xml file: </p><div class="fragment"><div class="line">&lt;uses-permission android:name=<span class="stringliteral">&quot;android.permission.VIBRATE&quot;</span>/&gt;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="a_common_2_ak_types_8h_a352a1eb6955fa208062e40a9ccdd2560_html_a352a1eb6955fa208062e40a9ccdd2560"><div class="ttname">AkGameObjectID</div><div class="ttdeci">AkUInt64 AkGameObjectID</div><div class="ttdoc">Game object ID.</div><div class="ttdef"><b>Definition:</b> AkTypes.h:142</div></div>
<div class="ttc" id="anamespace_a_k_1_1_sound_engine_a895ed0f83a0dea8fc284491c0ee0152c_html_a895ed0f83a0dea8fc284491c0ee0152c"><div class="ttname">AK::SoundEngine::RegisterGameObj</div><div class="ttdeci">AKSOUNDENGINE_API AKRESULT RegisterGameObj(AkGameObjectID in_gameObjectID)</div></div>
<div class="ttc" id="astruct_ak_output_settings_html"><div class="ttname"><a href="struct_ak_output_settings.html">AkOutputSettings</a></div><div class="ttdoc">Platform-independent initialization settings of output devices.</div><div class="ttdef"><b>Definition:</b> AkSoundEngine.h:116</div></div>
<div class="ttc" id="a_ak_motion_sink_factory_8h_html"><div class="ttname"><a href="_ak_motion_sink_factory_8h.html">AkMotionSinkFactory.h</a></div></div>
<div class="ttc" id="anamespace_a_k_1_1_sound_engine_a2f85a55c38afa2e0dbc6172a7bec91d1_html_a2f85a55c38afa2e0dbc6172a7bec91d1"><div class="ttname">AK::SoundEngine::SetListeners</div><div class="ttdeci">AKSOUNDENGINE_API AKRESULT SetListeners(AkGameObjectID in_emitterGameObj, const AkGameObjectID *in_pListenerGameObjs, AkUInt32 in_uNumListeners)</div></div>
<div class="ttc" id="anamespace_a_k_1_1_sound_engine_a15ab79f954a307902f529d8ccde8ad48_html_a15ab79f954a307902f529d8ccde8ad48"><div class="ttname">AK::SoundEngine::AddOutput</div><div class="ttdeci">AKSOUNDENGINE_API AKRESULT AddOutput(const AkOutputSettings &amp;in_Settings, AkOutputDeviceID *out_pDeviceID=NULL, const AkGameObjectID *in_pListenerIDs=NULL, AkUInt32 in_uNumListeners=0)</div></div>
<div class="ttc" id="a_ak_numeral_types_8h_a39c6c5d577901802ca77775760b704ce_html_a39c6c5d577901802ca77775760b704ce"><div class="ttname">AkUInt32</div><div class="ttdeci">uint32_t AkUInt32</div><div class="ttdoc">Unsigned 32-bit integer.</div><div class="ttdef"><b>Definition:</b> AkNumeralTypes.h:38</div></div>
<div class="ttc" id="anamespace_a_k_1_1_sound_engine_a41e9ef8d42951871fe4a8ae58a29a68e_html_a41e9ef8d42951871fe4a8ae58a29a68e"><div class="ttname">AK::SoundEngine::PostEvent</div><div class="ttdeci">AKSOUNDENGINE_API AkPlayingID PostEvent(AkUniqueID in_eventID, AkGameObjectID in_gameObjectID, AkUInt32 in_uFlags=0, AkCallbackFunc in_pfnCallback=NULL, void *in_pCookie=NULL, AkUInt32 in_cExternals=0, AkExternalSourceInfo *in_pExternalSources=NULL, AkPlayingID in_PlayingID=AK_INVALID_PLAYING_ID)</div></div>
</body>
</html>

